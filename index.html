<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>Platten-Gewichtsrechner | Nowoline</title>
  <style>
    :root {
      --bg: #0f172a; --card: #1e293b; --accent: #38bdf8;
      --success: #10b981; --danger: #f43f5e; --mut: #94a3b8; --border: #334155;
    }
    body {
      margin: 0; font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg); color: #f1f5f9; line-height: 1.5;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    .wrap { max-width: 1200px; margin: 1rem auto; padding: 0 0.5rem; flex: 1; }
    .brand-header { text-align: left; margin-bottom: 1rem; padding-left: 0.5rem; }
    .brand-header h1 { font-size: 1.8rem; margin: 0; color: white; letter-spacing: -1px; }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }

    .project-toggle {
      background: var(--card); border: 1px solid var(--border);
      color: var(--accent); width: 100%; text-align: left;
      padding: 0.75rem; border-radius: 8px; cursor: pointer;
      font-weight: bold; margin-bottom: 0.5rem; display: flex; justify-content: space-between;
    }
    .project-info { 
      display: none; flex-direction: column; gap: 0.75rem; 
      background: rgba(30, 41, 59, 0.5); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;
    }
    .project-info.open { display: flex; }

    .sticky-sum {
      position: sticky; top: 0.5rem; z-index: 100;
      background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(12px);
      border: 1px solid var(--accent); border-radius: 12px;
      padding: 0.75rem 1rem; margin-bottom: 1rem;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }
    .total-val { font-size: 1.5rem; font-weight: 800; color: var(--accent); }
    
    .btn {
      background: var(--card); border: 1px solid var(--border); color: #f1f5f9;
      padding: 0.5rem 0.8rem; border-radius: 8px; cursor: pointer; font-weight: 500;
      font-size: 0.8rem; transition: 0.2s;
    }
    .btn.ok { background: var(--success); border-color: var(--success); color: white; }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th { background: rgba(15, 23, 42, 0.5); padding: 0.8rem 0.5rem; font-size: 0.7rem; color: var(--mut); text-transform: uppercase; text-align: left; }
    td { padding: 0.75rem 0.5rem; border-bottom: 1px solid var(--border); vertical-align: middle; }
    
    input, select, textarea {
      background: #0f172a; border: 1px solid var(--border); color: white;
      padding: 0.6rem; border-radius: 6px; width: 100%; box-sizing: border-box; font-size: 0.9rem;
    }

    .row-flex { display: flex; gap: 6px; align-items: center; width: 100%; }
    .row-flex > div { flex: 1; min-width: 0; }

    .weight-cell { text-align: right; font-weight: bold; color: var(--accent); font-size: 1.1rem; white-space: nowrap; }

    .del-cell { text-align: center; width: 35px; }
    .del-btn { background:none; border:none; color:var(--danger); cursor:pointer; font-size: 1.2rem; opacity: 0.6; transition: 0.2s; }
    .del-btn:hover { opacity: 1; transform: scale(1.2); }

    footer { text-align: center; padding: 2rem; color: var(--mut); font-size: 0.8rem; border-top: 1px solid var(--border); margin-top: auto; }

    @media (max-width: 950px) {
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tr { 
        background: var(--card); border: 1px solid var(--border); 
        margin-bottom: 1.5rem; border-radius: 12px; padding: 1.2rem 1rem 1rem 1rem; 
        position: relative; 
      }
      td { border: none; padding: 0.4rem 0 !important; width: 100% !important; }
      td::before { content: attr(data-label); font-size: 0.65rem; color: var(--mut); text-transform: uppercase; margin-bottom: 0.2rem; display: block; font-weight: bold; }
      
      .del-cell { position: absolute; top: 6px; right: 12px; width: auto !important; z-index: 20; }
      .del-btn { font-size: 1.3rem; opacity: 0.8; }

      .weight-cell { text-align: left; margin-top: 0.5rem; padding-top: 0.75rem !important; border-top: 1px solid var(--border); font-size: 1.3rem; }
      input, select { font-size: 1rem; padding: 0.8rem; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="brand-header"><h1>Platten-Gewichtsrechner</h1></div>

  <button class="project-toggle no-print" onclick="document.getElementById('pInfo').classList.toggle('open')">
    üìÇ Projekt-Details & Notizen <span>‚ñº</span>
  </button>
  
  <div class="project-info" id="pInfo">
    <input type="text" id="projectTitle" placeholder="Projekt Name..." oninput="updateMeta()">
    <textarea id="projectNotes" placeholder="Bemerkungen..." oninput="updateMeta()"></textarea>
  </div>

  <div class="sticky-sum">
    <div>
      <div style="font-size:0.65rem; text-transform:uppercase; color:var(--mut)">Gesamtgewicht</div>
      <div class="total-val" id="totalKg">0,00 kg</div>
    </div>
    <div style="display:flex; gap:0.4rem; flex-wrap: wrap; justify-content: flex-end;">
      <button class="btn ok" id="btnAdd">+ Zeile</button>
      <button class="btn" onclick="window.print()">üñ®Ô∏è PDF</button>
      <button class="btn" id="btnExportTxt">üìÑ TXT</button>
      <button class="btn" id="btnReset" style="border-color:var(--danger); color:var(--danger)">Reset</button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width: 25%;">Material</th>
        <th style="width: 15%;">Typ / Form</th>
        <th style="width: 25%;">Ma√üe (mm)</th>
        <th style="width: 15%;">Dichte (kg/m¬≥)</th>
        <th style="width: 7%;">Stk</th>
        <th style="width: 10%; text-align:right">Gewicht</th>
        <th style="width: 3%;"></th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<footer>Platten-Gewichtsrechner 2.4 | ¬© Nowoline GmbH | Alle Angaben ohne Gew√§hr</footer>

<script>
(() => {
  const MATERIALS_DB = {
    "Plattenwerkstoffe": [
      { name: "Dekorspanplatte", density: 700 },
      { name: "Pappelspan", density: 450 },
      { name: "Spanplatte roh", density: 650 },
      { name: "HDF", density: 850 },
      { name: "MDF", density: 750 },
      { name: "OSB", density: 650 },
      { name: "HPL", density: 1350 },
      { name: "Kompaktplatte", density: 1450 },
      { name: "Corian", density: 1750 },
    ],
    "Massivplatten": [
      { name: "3S Fichte", density: 470},
      { name: "3S L√§rche", density: 580},
      { name: "3S Kiefer", density: 510},
      { name: "3S Eiche", density: 720},
      { name: "Sperrholz / Multiplex", density: 680 },
      { name: "Tischlerplatte", density: 500 },
    ],
    "Massivholz": [
      { name: "Massivholz (Buche)", density: 700 },
      { name: "Massivholz (Eiche)", density: 720 },
      { name: "Massivholz (Esche)", density: 700 },
      { name: "Massivholz (Fichte)", density: 470 },
      { name: "Massivholz (Nussbaum)", density: 640 },
      { name: "Massivholz (Tanne)", density: 480 },
      { name: "Massivholz (Tulipwood)", density: 450 }
    ],
    "Metall": [
      { name: "Metall: Aluminium", density: 2700 },
      { name: "Metall: Blei", density: 11340 },
      { name: "Metall: Edelstahl", density: 8000 },
      { name: "Metall: Kupfer", density: 8960 },
      { name: "Metall: Messing", density: 8500 },
      { name: "Metall: Stahl", density: 7850 },
    ],
    "Sonstiges": [
      { name: "Acrylglas (Plexi)", density: 1180 },
      { name: "Glas (Float)", density: 2500 },
      { name: "Alu-Verbund (Dibond)", density: 3500 },
      { name: "Beton", density: 2400 },
      { name: "PVC-Hartschaum", density: 600 },
      { name: "Fermacell", density: 1150 },
      { name: "Gipsplatte (Rigips)", density: 850 },
    ]
  };

  const getFlatMat = (name) => {
    for (let cat in MATERIALS_DB) {
      const found = MATERIALS_DB[cat].find(m => m.name === name);
      if (found) return found;
    }
    return { name: name, density: 0 };
  };

  let state = JSON.parse(localStorage.getItem('nowoline_final_pro')) || { title: "", notes: "", rows: [], favs: [] };
  const save = () => localStorage.setItem('nowoline_final_pro', JSON.stringify(state));

  const createRow = () => ({
    id: Math.random().toString(36).substr(2, 9),
    mat: "Spanplatte roh", mode: "dims", l: "", b: "", d: "", area: "", dia: "", idia: "", densOver: "", qty: 1, search: ""
  });

  const calcWeight = (r) => {
    const val = (v) => parseFloat(v) || 0;
    const mmM = (v) => val(v) / 1000;
    const dens = val(r.densOver) || getFlatMat(r.mat).density || 0;
    let vol = 0;
    if (r.mode === "dims") vol = mmM(r.l) * mmM(r.b) * mmM(r.d);
    else if (r.mode === "area") vol = val(r.area) * mmM(r.d);
    else if (r.mode === "cyl") vol = Math.PI * Math.pow(mmM(r.dia)/2, 2) * mmM(r.l);
    else if (r.mode === "tube") vol = Math.PI * (Math.pow(mmM(r.dia)/2, 2) - Math.pow(mmM(r.idia)/2, 2)) * mmM(r.l);
    return vol * dens * val(r.qty);
  };

  const updateTotal = () => {
    const total = state.rows.reduce((sum, r) => sum + calcWeight(r), 0);
    document.getElementById("totalKg").textContent = total.toLocaleString('de-DE', {minimumFractionDigits:2}) + " kg";
  };

  window.toggleFav = (mat) => {
    state.favs = state.favs.includes(mat) ? state.favs.filter(f => f !== mat) : [...state.favs, mat];
    save(); fullRender();
  };

  const renderOptions = (r) => {
    let html = "";
    const searchVal = (r.search || "").toLowerCase();
    const favItems = [];
    for (let cat in MATERIALS_DB) {
        MATERIALS_DB[cat].forEach(m => { if(state.favs.includes(m.name) && m.name.toLowerCase().includes(searchVal)) favItems.push(m); });
    }
    if (favItems.length > 0) {
        html += `<optgroup label="‚òÖ FAVORITEN">`;
        favItems.forEach(m => { html += `<option value="${m.name}" ${r.mat === m.name ? 'selected' : ''}>‚òÖ ${m.name}</option>`; });
        html += `</optgroup>`;
    }
    for (const [group, items] of Object.entries(MATERIALS_DB)) {
      const filtered = items.filter(m => m.name.toLowerCase().includes(searchVal));
      if (filtered.length > 0) {
        html += `<optgroup label="${group.toUpperCase()}">`;
        filtered.forEach(m => { html += `<option value="${m.name}" ${r.mat === m.name ? 'selected' : ''}>${m.name}</option>`; });
        html += `</optgroup>`;
      }
    }
    return html;
  };

  window.upd = (id, key, val) => {
    const r = state.rows.find(x => x.id === id);
    if (!r) return;
    r[key] = val;
    if (key === 'mode' || key === 'mat') fullRender();
    else if (key === 'search') document.getElementById(`sel-${id}`).innerHTML = renderOptions(r);
    else {
      const wEl = document.getElementById(`weight-${id}`);
      if(wEl) wEl.textContent = calcWeight(r).toLocaleString('de-DE', {minimumFractionDigits:2}) + " kg";
      updateTotal();
    }
    save();
  };

  const fullRender = () => {
    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";
    document.getElementById("projectTitle").value = state.title || "";
    document.getElementById("projectNotes").value = state.notes || "";

    state.rows.forEach(r => {
      const isFav = state.favs.includes(r.mat);
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Material">
          <div class="row-flex">
            <button onclick="toggleFav('${r.mat}')" style="background:none; border:none; color:${isFav?'#facc15':'#94a3b8'}; cursor:pointer; font-size:1.2rem; padding:0 5px;">${isFav?'‚òÖ':'‚òÜ'}</button>
            <div style="flex:1;">
              <select id="sel-${r.id}" onchange="upd('${r.id}', 'mat', this.value)">${renderOptions(r)}</select>
              <input type="text" class="no-print" placeholder="üîç Suchen..." value="${r.search||''}" oninput="upd('${r.id}', 'search', this.value)" style="margin-top:4px; font-size:0.75rem; padding:4px;">
            </div>
          </div>
        </td>
        <td data-label="Typ / Form">
          <select onchange="upd('${r.id}', 'mode', this.value)">
            <option value="dims" ${r.mode==='dims'?'selected':''}>Rechteck</option>
            <option value="area" ${r.mode==='area'?'selected':''}>Fl√§che</option>
            <option value="cyl" ${r.mode==='cyl'?'selected':''}>Rundstab</option>
            <option value="tube" ${r.mode==='tube'?'selected':''}>Rohr</option>
          </select>
        </td>
        <td data-label="Ma√üe (mm)">
          <div class="row-flex">
          ${r.mode==='dims'? `<div><input type="number" placeholder="L" value="${r.l}" oninput="upd('${r.id}','l',this.value)"></div>
                             <div><input type="number" placeholder="B" value="${r.b}" oninput="upd('${r.id}','b',this.value)"></div>
                             <div><input type="number" placeholder="D" value="${r.d}" oninput="upd('${r.id}','d',this.value)"></div>` :
            r.mode==='area'? `<div><input type="number" placeholder="m¬≤" value="${r.area}" oninput="upd('${r.id}','area',this.value)"></div>
                             <div><input type="number" placeholder="D" value="${r.d}" oninput="upd('${r.id}','d',this.value)"></div>` :
            r.mode==='tube'? `<div><input type="number" placeholder="A-√ò" value="${r.dia}" oninput="upd('${r.id}','dia',this.value)"></div>
                             <div><input type="number" placeholder="I-√ò" value="${r.idia}" oninput="upd('${r.id}','idia',this.value)"></div>
                             <div><input type="number" placeholder="L" value="${r.l}" oninput="upd('${r.id}','l',this.value)"></div>` :
                             `<div><input type="number" placeholder="√ò" value="${r.dia}" oninput="upd('${r.id}','dia',this.value)"></div>
                             <div><input type="number" placeholder="L" value="${r.l}" oninput="upd('${r.id}','l',this.value)"></div>`}
          </div>
        </td>
        <td data-label="Dichte (kg/m¬≥)">
          <input type="number" placeholder="${getFlatMat(r.mat).density}" value="${r.densOver}" oninput="upd('${r.id}', 'densOver', this.value)">
        </td>
        <td data-label="Stk">
          <input type="number" value="${r.qty}" oninput="upd('${r.id}', 'qty', this.value)">
        </td>
        <td data-label="Gewicht" class="weight-cell" id="weight-${r.id}">${calcWeight(r).toLocaleString('de-DE', {minimumFractionDigits:2})} kg</td>
        <td class="del-cell no-print"><button class="del-btn" onclick="removeRow('${r.id}')">‚úï</button></td>
      `;
      tbody.appendChild(tr);
    });
    updateTotal();
  };

  window.removeRow = (id) => { state.rows = state.rows.filter(r => r.id !== id); if(!state.rows.length) state.rows.push(createRow()); fullRender(); save(); };
  window.updateMeta = () => { state.title = document.getElementById("projectTitle").value; state.notes = document.getElementById("projectNotes").value; save(); };

  document.getElementById("btnExportTxt").onclick = () => {
    let txt = `NOWOLINE - GEWICHTSBERECHNUNG\n`;
    txt += `PROJEKT: ${state.title || 'Ohne Name'}\n`;
    txt += `NOTIZEN: ${state.notes || '-'}\n`;
    txt += `==========================================\n\n`;
    state.rows.forEach((r, i) => {
      let dims = "";
      if (r.mode === "dims") dims = `${r.l || 0}x${r.b || 0}x${r.d || 0}mm`;
      else if (r.mode === "area") dims = `${r.area || 0}m¬≤ x ${r.d || 0}mm`;
      else if (r.mode === "tube") dims = `A-√ò:${r.dia || 0} / I-√ò:${r.idia || 0} / L:${r.l || 0}mm`;
      else dims = `√ò:${r.dia || 0} / L:${r.l || 0}mm`;

      const w = calcWeight(r).toLocaleString('de-DE', {minimumFractionDigits:2});
      txt += `${String(i+1).padStart(2, '0')}. ${r.mat.padEnd(20)} | ${dims.padEnd(25)} | ${r.qty} Stk. | ${w} kg\n`;
    });
    txt += `\n==========================================\n`;
    txt += `GESAMTGEWICHT: ${document.getElementById("totalKg").textContent}\n\n`;
    txt += `Platten-Gewichtsrechner 2.4 | ¬© Nowoline GmbH \n`;
    txt += `Alle Angaben ohne Gew√§hr.`;
    
    const blob = new Blob([txt], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `Gewicht_${state.title || 'Export'}.txt`;
    a.click();
  };

  document.getElementById("btnAdd").onclick = () => { state.rows.push(createRow()); fullRender(); save(); };
  document.getElementById("btnReset").onclick = () => { if(confirm("Wirklich alles l√∂schen?")) { state.rows = [createRow()]; state.title=""; state.notes=""; fullRender(); save(); } };
  
  fullRender();
})();
</script>
</body>
</html>